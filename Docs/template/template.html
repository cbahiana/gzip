<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="$lang$" xml:lang="$lang$" $if(dir)$ dir="$dir$" $endif$>

<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  $for(author-meta)$
  <meta name="author" content="$author-meta$" />
  $endfor$
  $if(date-meta)$
  <meta name="dcterms.date" content="$date-meta$" />
  $endif$
  $if(keywords)$
  <meta name="keywords" content="$for(keywords)$$keywords$$sep$, $endfor$" />
  $endif$
  <title>$if(title-prefix)$$title-prefix$ â€“ $endif$$pagetitle$</title>
  $for(css)$
  <link rel="stylesheet" href="$css$" />
  $endfor$
  $if(math)$
  $math$
  $endif$
  $for(header-includes)$
  $header-includes$
  $endfor$
  <style>
    .bd-navbar {
      position: sticky;
      top: 0;
      z-index: 1071;
    }

    pre {
      background-color: #f4f4f4;
      padding: 15px;
      box-shadow: 0 3px 6px rgba(0, 0, 0, .25);
    }

    .header-big {

      height: 200px;
      background: url(../images/bg-filter.jpg) no-repeat;
      background-size: 100% auto;
      box-shadow: 0 3px 3px 4px rgba(0, 0, 0, 0.37);
      margin-bottom: 25px;
    }

    .bd-sidebar {
      position: -webkit-sticky;
      position: sticky;
      top: 4rem;
      z-index: 1000;
      height: calc(100vh - 4rem);
      overflow: auto;
    }

    .bd-toc-link {
      display: block;
      color: rgba(0, 0, 0, .65);
      padding: .25rem 1.5rem;
    }

    .nav-level-1>.bd-toc-item>.bd-toc-link {

      font-weight: 600;
    }

    .nav-level-2>.bd-toc-item>.bd-toc-link {

      font-weight: 500;
      font-size: .95rem;
    }

    .nav-level-3>.bd-toc-item {

      padding-left: 1rem;
    }

    .nav-level-3>.bd-toc-item>.bd-toc-link {

      font-weight: 400;
      font-size: .85rem;
    }

    .bd-toc-item {
      display: block;
      width: 100%;
    }

    .side-bar>ul>li>ul>li:not(.open)>a+ul {

      display: none;
    }

    .nav-level-2>.active>.bd-toc-link {
      font-weight: 600;
      color: rgba(0, 0, 0, .85);
      background-color: transparent;
    }

    .nav-level-2>.open>.bd-toc-link::after {
      content: ' \2014 ';
      text-align: right;
    }

    figure img {
      box-shadow: 0 3px 6px rgba(0, 0, 0, .25);
      margin-bottom: 10px;
    }

    figure figcaption {
      font-size: .8rem;
      color: #777474;
    }
  </style>
</head>

<body>
  $for(include-before)$
  $include-before$
  $endfor$
  <header class="bd-navbar">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <a class="navbar-brand" href="#"> </a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#general-settings">General Settings</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#http-settings">HTTP Settings</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#cdn">CDN</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#images">Images</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#javascript">Javascript</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#css">CSS</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#critical-css">Critical CSS</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#service-worker">Service Worker</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#web-share-target">Web Share Target</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#network-settings">Network Settings</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#cache">Cache</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#background-sync">Background Sync</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#web-push">Web Push</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#security">Security</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#content-security-policy-csp">Content Security Policy (CSP)</a>
          </li>
          <!--
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
              aria-haspopup="true" aria-expanded="false">
              Dropdown
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
              <a class="dropdown-item" href="#">Action</a>
              <a class="dropdown-item" href="#">Another action</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="#">Something else here</a>
            </div>
          </li>-->
        </ul>
      </div>
    </nav>
  </header>
  <div class="d-none d-md-block header-big"></div>
  <div class="container-fluid">
    <div class="row flex-xl-nowrap">
      $if(toc)$
      <div class="col-12 col-md-3 col-xl-2 bd-sidebar d-none d-sm-block">
        <nav class="side-bar" role="doc-toc">
          $table-of-contents$
        </nav>
      </div>
      <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content" role="main">
        $if(title)$
        <h1 class="title">$title$</h1>
        $if(subtitle)$
        <p class="subtitle">$subtitle$</p>
        $endif$
        <!-- $for(author)$
        <p class="author">$author$</p>
        $endfor$ -->
        $if(date)$
        <p class="date">$date$</p>
        $endif$
        $endif$
        $body$
      </main>
      $else$
      <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content" role="main">
        $body$
      </main>
      $endif$
    </div>
  </div>
  $for(include-after)$
  $include-after$
  $endfor$
  <script>
    const links = document.querySelector('.side-bar').addEventListener('click', function (e) {

      const target = e.target;

      if (target.matches('.side-bar>ul>li>ul>li>a')) {

        target.parentElement.classList.toggle('open');
      }
    }, false);

    if (window.IntersectionObserver) {

      //  let active;
      //  function select (fragment) 

      const sidebar = document.querySelector('.side-bar');
      const menu = document.querySelector('#navbarSupportedContent');

      // active bd-sidenav-active
      const observer = new IntersectionObserver(function (entries) {
        // consider only the first visible item
        //  let firstEntry;

        /*
         */

        entries.some(function (entry) {

          if (entry.isIntersecting) {

            let node = entry.target;
            const fragment = entry.target.id;

            // parent previously selected?
            if (sidebar.querySelector('.nav-level-2 li.active a[href="#' + fragment + '"]')) {

              // -> TODO: select the node in the navbar and exit
              return true;
            }

            Array.from(Array.from(sidebar.querySelectorAll('.nav-level-2 li.active'))).concat(Array.from(menu
                .querySelectorAll('.navbar-nav>.active')))
              .forEach(function (entry) {

                if (entry) {

                  entry.classList.remove('active', 'bd-sidenav-active');
                }
              });

            do {
              // h3
              Array.from(sidebar.querySelectorAll('li>a[href="#' + fragment + '"]')).forEach(function (link) {

                //   if (node.tagName == 'H4') {

                let parent = link.parentElement;

                parent.classList.add('active', 'bd-sidenav-active');

                do {

                  parent = parent.parentElement;

                  if (parent && parent.tagName == 'LI') {

                    parent.classList.add('active', 'bd-sidenav-active');

                    if (parent.firstElementChild.tagName == 'A') {

                      const menulink = menu.querySelector('li>a[href="' + parent.firstElementChild
                        .hash + '"]');

                      if (menulink) {

                        menulink.parentElement.classList.add('active', 'bd-sidenav-active');
                      }
                    }
                    //  break;
                  }
                }

                while (parent && parent.tagName != 'LI');
                //  }

              });

              if (node == entry.target) {

                node = null;
              }
            }

            while (node && node.tagName != 'H3');

            return true;
          }

          return false;
        });

      }, {
        //  rootMargin: '40px 0px 0px',
        threshold: .1
      });

      Array.from(document.querySelectorAll('h3[id],h4[id]')).forEach(function (node) {

        observer.observe(node);
      })
    }

    const btn = document.querySelector('[data-toggle="collapse"]');
    const toggle = btn.dataset.toggle;
    const menu = document.querySelector(btn.dataset.target);

    menu.addEventListener('click', function (e) {

      if (e.target.tagName == 'A') {

        menu.classList.add(toggle)
      }
    });

    btn.addEventListener('click', function (e) {

      e.stopPropagation();
      menu.classList.toggle(toggle)
    }, false);

    document.body.addEventListener('click', function (e) {

      if (e.target.matches('a[href*="*#*"]')) {

        e.preventDefault();

        history.push(e.target.hash)

        document.querySelector(e.target.hash).scrollIntoView({
          behavior: 'smooth'
        })
      }
    }, false);
  </script>
</body>

</html>