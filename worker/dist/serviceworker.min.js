!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(self,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return{}.hasOwnProperty.call(e,t)},r.p="",r(r.s=14)}([function(e,t,r){"use strict";r.r(t);var n=r(1),s=r(5),o=r(2),a=r(4),c=r(7),i=r(3),u=r(6);r(15),r(16),r(17),r(18),u.Utils.merge(!0,i.SW,s.Event);const l=i.SW.routes,f=i.SW.app.scope;let h,p,d="{defaultStrategy}";for(h of"{exclude_urls}")l.registerRoute(new a.Router.RegExpRouter(new RegExp(h),c.strategies.get("no")));for(h of"{network_strategies}")p=h[2]||"{cacheExpiryStrategy}",l.registerRoute(new a.Router.RegExpRouter(new RegExp(h[1],"i"),c.strategies.get(h[0]),null==p?p:{plugins:[new o.expiration.CacheExpiration(p)]}));for(h of c.strategies)l.registerRoute(new a.Router.ExpressRouter(f+"/{ROUTE}/media/z/"+h[0]+"/",h[1]));c.strategies.has(d)||(d="no"),l.setDefaultRouter(new a.Router.ExpressRouter("/",c.strategies.get(d))),i.SW.on({async install(){await caches.open(i.cacheName).then(async e=>{await e.addAll("{preloaded_urls}")})},async activate(){const e=await Object(n.DB)("gzip_sw_worker_config_cache_private","name"),t=await e.get("gzip");if(null!=t&&"{ROUTE}"!=t.route){let e,t;for(e of"{STORES}")null!=(t=await Object(n.DB)(e,"url",[{name:"url",key:"url"},{name:"version",key:"version"},{name:"route",key:"route"}]))&&t.clear()}await e.put(i.SW.app);const r=await caches.keys(),s=i.cacheName.split(/_/,2),o=2==s.length&&s[0]+"_";0!=o&&await Promise.all(r.map(e=>0==e.indexOf(o)&&e!=i.cacheName&&caches.delete(e)))}})},function(e,t,r){"use strict";async function n(e,t="id",r=[]){return new Promise((n,s)=>{const o=indexedDB.open(e,1),a=`${e}_store`;let c;const i=(e,t,r=null,n=null)=>new Promise((s,o)=>{const i=t?"readonly":"readwrite";if(c.objectStoreNames.contains(a)){const t=c.transaction(a,i),u=t.objectStore(a);let l;"put"===e&&r&&void 0!==r.length?(l=t,r.forEach(e=>{u.put(e)})):(n&&u.index(n),l=u[e](r)),l.oncomplete=(e=>{s(e.target.result)}),l.onsuccess=(e=>{s(e.target.result)}),l.onerror=(e=>{o(e)})}else o(new Error("Store not found"))}),u={count:()=>i("count",!0,keyToUse),get:(e,t)=>i("get",!0,e,t),getAll:(e,t)=>i("getAll",!0,e,t),put:e=>i("put",!1,e),delete:e=>i("delete",!1,e),clear:()=>i("clear",!1)};o.onupgradeneeded=(()=>{const e=(c=o.result).createObjectStore(a,{keyPath:t});let n;for(n of r)e.createIndex(n.name,n.key,n.options)}).bind(this),o.onsuccess=(()=>{c=o.result,n(u)}).bind(this),o.onerror=(e=>{s(new Error(e))}).bind(this)})}r.r(t),r.d(t,"DB",function(){return n})},function(e,t,r){"use strict";r.r(t),r.d(t,"expiration",function(){return a});var n=r(1),s=r(3),o=r(6);const a=Object.create(null);a.CacheExpiration=class{constructor(e){this.setOptions(e)}getRouteTag(e){const t=s.SW.app.route;let r;for(r of s.SW.app.urls)if(new RegExp("^https?://"+r+"/"+t+"/").test(e))return t;return null}async setOptions(e){this.limit=+e.limit||0,this.maxAge=1e3*+e.maxAge||0;try{this.db=await Object(n.DB)(null!=e.cacheName?e.cacheName:"gzip_sw_worker_expiration_cache_private","url",[{name:"url",key:"url"},{name:"version",key:"version"},{name:"route",key:"route"}])}catch(e){console.error("ðŸ˜­",e)}}async precheck(e){try{if(null==this.db)return!0;const t=o.Utils.getObjectHash(e.request),r=await this.db.get(e.request.url,"url"),n=await caches.open(s.cacheName);return null==r||r.version==t&&r.timestamp>=Date.now()?await n.match(e.request):(e.request.url,caches.delete(e.request),!0)}catch(e){console.error("ðŸ˜­",e)}return!0}async postcheck(e){if(null==this.db)return!0;try{const t=e.request.url,r=await this.db.get(t,"url"),n=o.Utils.getObjectHash(e.request);return null==r||r.version!=n||r.timestamp<Date.now()?(Date.now(),this.maxAge,new Date(Date.now()+this.maxAge).toUTCString(),await this.db.put({url:t,method:e.request.method,timestamp:Date.now()+this.maxAge,route:this.getRouteTag(t),version:n})):(r.timestamp,new Date(r.timestamp).toUTCString(),t)}catch(e){console.error("ðŸ˜­",e)}return!0}}},function(e,t,r){"use strict";r.r(t),r.d(t,"cacheName",function(){return o}),r.d(t,"SW",function(){return s});var n=r(4);const s=Object.create(null),o="{CACHE_NAME}";Object.defineProperties(s,{app:{value:Object.create(null)},routes:{value:new n.Route}}),Object.defineProperties(s.app,{name:{value:"gzip",enumerable:!0},scope:{value:"{scope}",enumerable:!0},route:{value:"{ROUTE}",enumerable:!0},cacheName:{value:"{CACHE_NAME}",enumerable:!0},codeName:{value:"Page Optimizer Plugin",enumerable:!0},build:{value:"{VERSION}",enumerable:!0},buildid:{value:"929f400",enumerable:!0},builddate:{value:"2019-05-26 20:47:15-04:00",enumerable:!0},urls:{value:"{CDN_HOSTS}",enumerable:!0},homepage:{value:"https://github.com/tbela99/gzip",enumerable:!0}})},function(e,t,r){"use strict";r.r(t),r.d(t,"Route",function(){return i}),r.d(t,"Router",function(){return u});var n=r(5),s=r(6);const o=null,a="ðŸ˜­";function c(e="GET"){return e==o||"HEAD"==e?"GET":e.toUpperCase()}class i{constructor(){this.routers=Object.create(o),this.defaultRouter=Object.create(o)}getRouter(e){const t=e!=o&&e.request.method||"GET",r=this.routers[t]||[],n=r.length;let s,a=0;for(;n>a;a++)if((s=r[a]).match(e))return s.strategy,s.constructor.name,e.request.url,s.path,s;return this.defaultRouter[t]}registerRoute(e,t="GET"){return(t=c(t))in this.routers||(this.routers[t]=[]),this.routers[t].push(e),this}unregisterRoute(e,t){t=c(t);const r=this.routers[t]||[],n=r.indexOf(e);return-1!=n&&r.splice(n,1),this}setDefaultRouter(e,t){this.defaultRouter[c(t)]=e}}class u{constructor(e,t,r){const n=this;n.options=Object.assign(Object.create({plugins:[]}),r||{}),n.path=e,n.strategy=t.name,n.handler={handle:async e=>{let r,s,c,i;try{for(i of n.options.plugins)c=await i.precheck(e,s),s==o&&c instanceof Response&&(s=c);if(Response,e.request.url,s instanceof Response)return s;for(s of r=await n.resolve("beforeroute",e,s))if(s instanceof Response)return s}catch(e){console.error(a,e)}for(i of(s=await t.handle(e),r=await n.resolve("afterroute",e,s),n.options.plugins))await i.postcheck(e,s);for(c of r)if(c instanceof Response)return c;return s}}}}s.Utils.merge(!0,u.prototype,n.Event),u.RegExpRouter=class extends u{match(e){const t=e.request.url;return/^https?:/.test(t)&&this.path.test(t)}},u.ExpressRouter=class extends u{constructor(e,t,r){super(e,t,r),this.url=new URL(e,self.origin)}match(e){const t=e.request.url,r=new URL(t);return/^https?:/.test(t)&&r.origin==this.url.origin&&0==r.pathname.indexOf(this.url.pathname)}},u.CallbackRouter=class extends u{match(e){return this.path(e.request.url,e)}}},function(e,t,r){"use strict";r.r(t),r.d(t,"Event",function(){return s});const n=r(6).Utils.extendArgs,s={$events:{},$pseudo:{},on:n(function(e,t,r){const n=this;if(null==t)return;let s,o;const a=e=e.toLowerCase(),c={fn:t,cb:t,name:e,original:e,parsed:[e]};if(-1!=e.indexOf(":")){const t=e.match(/([^:]+):([^(]+)(\(([^)]+)\))?/);null==t?c.name=e=e.split(":",1)[0]:(c.original=e,c.name=t[1],c.parsed=t,e=t[1],t[2]in n.$pseudo&&n.$pseudo[t[2]](c))}e in n.$events||(n.$events[e]=[]),s=n.$events[e].length;for(;s&&s--;)if((o=n.$events[e][s]).fn==t&&o.original==a)return;Object.defineProperty(c,"sticky",{value:!!r}),n.$events[e].push(c)}),off:n(function(e,t,r){const n=this;let s,o;e=e.toLowerCase().split(":",1)[0];const a=n.$events[e];if(void 0!=a){for(r=!!r,o=a.length;o&&o--;)s=a[o],(void 0!=t||r)&&(s.fn!=t||s.sticky&&s.sticky!=r)||n.$events[e].splice(o,1);0==a.length&&delete n.$events[e]}}),resolve(e){e=e.toLowerCase();const t=this,r=arguments.length>1?[].slice.call(arguments,1):[];return Promise.all((t.$events[e]||[]).concat().map(e=>new Promise(n=>{n(e.cb.apply(t,r))})))},addPseudo(e,t){return this.$pseudo[e]=t,this}};s.addPseudo("once",function(e){return e.cb=function(){const t=e.fn.apply(this,arguments);return this.off(e.name,e.fn),t},this})},function(e,t,r){"use strict";r.r(t),r.d(t,"Utils",function(){return s});const n=null,s={implement(e){const t=e.prototype,r=[].slice.call(arguments,1);let n,s,a;function c(e,t,r){return function(){const n="previous"in this,s="parent"in this,o=this.previous,a=this.parent;this.previous=t,this.parent=r;const c=e.apply(this,arguments);return n&&(this.previous=o),s&&(this.parent=a),c}}for(n=0;n<r.length;n++)for(a in r[n])switch(typeof(s=r[n][a])){case"function":t[a]=c(s,e[a],t[a]);break;case"object":t[a]=o(!0,Array.isArray(s)?[]:{},s);break;default:t[a]=s}return e},merge:o,reset:function e(t){const r=s.getAllPropertiesName(t);let a,c,i=r.length;for(;i&&i--;)a=r[i],c=Object.getOwnPropertyDescriptor(t,a),t[a]!=n&&"object"==typeof t[a]&&c!=n&&"value"in c&&c.writable&&c.configurable&&(t[a]=o(!0,Array.isArray(t[a])?[]:{},e(t[a])));return t},extendArgs:e=>(function(t){if("object"==typeof t){const r=[].slice.call(arguments,1);let n;for(n in t)e.apply(this,[n,t[n]].concat(r))}else e.apply(this,arguments);return this}),getAllPropertiesName(e){const t=[];let r,n,s,o=e;do{for(r=Object.getOwnPropertyNames(o),s=0;s<r.length;s++)n=r[s],-1===t.indexOf(n)&&t.push(n)}while(o=Object.getPrototypeOf(o));return t},getOwnPropertyDescriptorNames(e){let t=Object.keys(Object.getOwnPropertyDescriptors(e)),r=Object.getPrototypeOf(e);for(;r;)t=t.concat(Object.keys(Object.getOwnPropertyDescriptors(r))),r=Object.getPrototypeOf(r);return t},getObjectHash:e=>(function(e){let t,r,n=0;if(0==e.length)return n;for(r=0;r<e.length;r++)n=(n<<5)-n+(t=e.charCodeAt(r)),n&=n;return n})(function e(t){let r,n,o,a,c="",i=0;if(!t&&"object"==typeof t||"string"==typeof t)c=""+("string"==t?JSON.stringify(t):t);else{const u=s.getOwnPropertyDescriptorNames(t);for(;i<u.length;i++){r=u[i];try{n=t[r]}catch(e){c+="!Error["+JSON.stringify(e.message)+"],";continue}if(c+=r+":",Array.isArray(n)){for(c+="[",a=0;a<n.length;a++)c+=e(n[a])+",";","==c[c.length-1]&&(c=c.substr(0,c.length-2)),c+="]"}else if("object"==typeof n)if(n&&"string"!=typeof n)if(null!=n[Symbol.iterator])if(n.constructor&&n.constructor.name&&(c+=n.constructor.name),"function"==typeof n.forEach)c+="{",n.forEach((t,r)=>c+=r+":"+e(t)+","),","==c[c.length-1]&&(c=c.substr(0,c.length-2)),c+="}";else{for(o of(c+="[",n))c+=e(o)+",";","==c[c.length-1]&&(c=c.substr(0,c.length-2)),c+="]"}else c+="{"+e(n)+"}";else c+=""+n;else c+=JSON.stringify(n);c+=","}","==c[c.length-1]&&(c=c.substr(0,c.length-2)),Array.isArray(t)?c="["+c+"]":"object"==typeof t&&(c="{"+c+"}")}return c}(e)).toString(16)};function o(e){const t=[].slice.call(arguments,1);let r,s,a,c,i="boolean"==typeof e;for(!0===i&&(i=e,e=t.shift()),r=0;r<t.length;r++)if((s=t[r])!=n)for(a in s)switch(typeof(c=s[a])){case"object":e[a]=c!=n&&i?o(i,"object"==typeof e[a]&&e[a]!=n?e[a]:Array.isArray(c)?[]:{},c):c;break;default:e[a]=c}return e}},function(e,t,r){"use strict";r.r(t);var n=r(8),s=r(10),o=r(11),a=r(12),c=r(13),i=r(9);r.d(t,"strategies",function(){return i.strategies}),i.strategies.add("cf",n.cacheFirst,"Cache fallback to Network"),i.strategies.add("cn",s.cacheNetwork,"Cache and Network Update"),i.strategies.add("co",o.cacheOnly,"Cache Only"),i.strategies.add("nf",a.networkFirst,"Network fallback to Cache"),i.strategies.add("no",c.networkOnly,"Network Only")},function(e,t,r){"use strict";r.r(t),r.d(t,"cacheFirst",function(){return o});var n=r(9),s=r(3);async function o(e){"use strict;";let t=await caches.match(e.request,{cacheName:s.cacheName});if(null!=t)return t;if(t=await fetch(e.request),n.strategies.isCacheableRequest(e.request,t)){const r=t.clone();caches.open(s.cacheName).then(t=>t.put(e.request,r))}return t}},function(e,t,r){"use strict";r.r(t),r.d(t,"strategies",function(){return s});const n=new Map,s={add:(e,t,r)=>n.set(e,{key:e,name:null==r?e:r,handle:async e=>{const r=await t(e);return e.clientId,r.type,e.request.mode,r.ok,r.bodyUsed,r&&r.type,s.isCacheableRequest(e.request,r),e.request.url,r&&r.url,r}}),keys:()=>n.keys(),values:()=>n.values(),entries:()=>n.entries(),get:e=>n.get(e),has:e=>n.has(e),delete:e=>n.delete(e),isCacheableRequest:(e,t)=>t instanceof Response&&("cors"==t.type||new URL(e.url,self.origin).origin==self.origin)&&"GET"==e.method&&t.ok&&["default","cors","basic","navigate"].includes(t.type)&&!t.bodyUsed};s[Symbol.iterator]=(()=>n[Symbol.iterator]()),Object.defineProperty(s,"size",{get:()=>n.size})},function(e,t,r){"use strict";r.r(t),r.d(t,"cacheNetwork",function(){return o});var n=r(9),s=r(3);async function o(e){"use strict;";const t=await caches.match(e.request,{cacheName:s.cacheName}),r=fetch(e.request).then(t=>{if(n.strategies.isCacheableRequest(e.request,t)){const r=t.clone();caches.open(s.cacheName).then(t=>t.put(e.request,r))}return t}).catch(e=>console.error("ðŸ˜­",e));return t||r}},function(e,t,r){"use strict";r.r(t),r.d(t,"cacheOnly",function(){return s});var n=r(3);async function s(e){return caches.match(e.request,{cacheName:n.cacheName})}},function(e,t,r){"use strict";r.r(t),r.d(t,"networkFirst",function(){return o});var n=r(9),s=r(3);async function o(e){"use strict;";try{const t=await fetch(e.request);if(null==t)throw new Error("Network error");if(n.strategies.isCacheableRequest(e.request,t)){const r=t.clone();caches.open(s.cacheName).then(t=>t.put(e.request,r))}return t}catch(e){console.error("ðŸ˜­",e)}return caches.match(e.request,{cacheName:s.cacheName})}},function(e,t,r){"use strict";async function n(e){return fetch(e.request)}r.r(t),r.d(t,"networkOnly",function(){return n})},function(e,t,r){e.exports=r(0)},function(e,t,r){"use strict";r.r(t);var n=r(3);self.addEventListener("activate",e=>{e.waitUntil((async()=>{try{await n.SW.resolve("activate",e)}catch(e){console.error("ðŸ˜­",e)}return self.clients.claim()})())})},function(e,t,r){"use strict";r.r(t);var n=r(3);self.addEventListener("fetch",e=>{const t=n.SW.routes.getRouter(e);null!=t&&e.respondWith(t.handler.handle(e).catch(t=>(console.error("ðŸ˜­",t),fetch(e.request))))})},function(e,t,r){"use strict";r.r(t);var n=r(3);self.addEventListener("install",e=>{e.waitUntil((async()=>{try{await n.SW.resolve("install",e)}catch(e){console.error("ðŸ˜­",e)}return self.skipWaiting()})())})},function(e,t){self.addEventListener("sync",e=>{})}])});
